import math

import matplotlib.pyplot as plt
import shapely
from autoware_auto_perception_msgs.msg import TrackedObject
from geometry_msgs.msg import Quaternion
from shapely import Point
from autoware.map_service import load_map_service

from autoware.utils import quaternion_2_heading, obstacle_to_polygon, AUTOWARE_VEHICLE_WIDTH, AUTOWARE_VEHICLE_LENGTH, \
    AUTOWARE_VEHICLE_back_edge_to_center
from matplotlib.patches import Polygon

ego_pose = [
   (15710.734564485683, 46201.62349915939, 0.01239900913492245, -0.005853326956866065, -0.0009977687492201657,
             -0.985763150671219, 0.16803497790582378), (
                15710.734550738003, 46201.62349433221, 0.012399182172358877, -0.005853326956869192,
                -0.0009977687492206987,
                -0.985763150671219, 0.16803497790582378), (
                15710.734458622663, 46201.623461988085, 0.012400341649050146, -0.00585332695689015,
                -0.0009977687492242714,
                -0.9857631506712189, 0.16803497790582375), (
                15710.734212274436, 46201.62337548872, 0.012403442417576684, -0.005853326956946187,
                -0.0009977687492338239,
                -0.9857631506712186, 0.1680349779058237), (
                15710.733734844396, 46201.62320785043, 0.01240945179736576, -0.00585332695705479,
                -0.0009977687492523375,
                -0.9857631506712179, 0.16803497790582358), (
                15710.732956465503, 46201.62293454106, 0.012419249240549237, -0.005853326957231856,
                -0.0009977687492825206,
                -0.9857631506712168, 0.1680349779058232), (
                15710.731817184747, 46201.622534509515, 0.012433589350980464, -0.005853326957491016,
                -0.0009977687493266981,
                -0.9857631506712153, 0.1680349779058227), (
                15710.730269623353, 46201.621991119864, 0.0124530684395202, -0.005853326957843045,
                -0.0009977687493867074,
                -0.9857631506712133, 0.1680349779058221), (
                15710.728276998554, 46201.6212914567, 0.01247814957760379, -0.005853326958296313,
                -0.0009977687494639737,
                -0.9857631506712107, 0.16803497790582125), (
                15710.725810471127, 46201.62042539381, 0.012509195682334648, -0.005853326958857372,
                -0.000997768749559617,
                -0.9857631506712075, 0.16803497790582045), (
                15710.722847631243, 46201.61938506253, 0.012546488876058904, -0.005853326959531317,
                -0.0009977687496745015,
                -0.9857631506712035, 0.16803497790581912), (
                15710.719371653437, 46201.61816455498, 0.012590240892288513, -0.005853326957626051,
                -0.0009977687656246715,
                -0.9857631511252208, 0.1680349752423362), (
                15710.715368755953, 46201.616759032106, 0.012640625224202876, -0.005853326939876458,
                -0.0009977688752477074,
                -0.9857631542677742, 0.16803495680677602), (
                15710.710828565301, 46201.61516485183, 0.012697772131778012, -0.0058533268763357,
                -0.0009977692542387311,
                -0.9857631651426341, 0.16803489301026123), (
                15710.705743496012, 46201.613379351475, 0.012761777103445357, -0.00585332674421014,
                -0.0009977700363265189,
                -0.9857631875888102, 0.16803476133148262), (
                15710.700108418263, 46201.611400731235, 0.01283270420223174, -0.005853326477566699,
                -0.0009977716083150112,
                -0.9857632327104484, 0.16803449662855266), (
                15710.693920433934, 46201.609227976725, 0.012910589454653858, -0.005853325956826291,
                -0.0009977746717323877,
                -0.9857633206464982, 0.16803398075668116), (
                15710.687178067546, 46201.606860575645, 0.012995450620310437, -0.00585332505034212,
                -0.000997779998943783,
                -0.9857634735690177, 0.16803308364150615), (
                15710.679880786693, 46201.60429835048, 0.01308729349151371, -0.005853323594615255,
                -0.0009977885492718872,
                -0.9857637190161482, 0.1680316437233178), (
                15710.672027119199, 46201.601540798605, 0.013186135545203908, -0.005853321401909702,
                -0.0009978014244212965,
                -0.985764088611492, 0.1680294754643897), (
                15710.663612332974, 46201.598586279084, 0.013292035155275713, -0.005853318251469833,
                -0.0009978199201621288,
                -0.9857646195462225, 0.16802636064542073), (
                15710.654628523456, 46201.59543204519, 0.01340509040413598, -0.00585331389431521, -0.000997845498436745,
                -0.9857653537759581, 0.1680220530638051), (
                15710.64506500803, 46201.59207438473, 0.013525434126057738, -0.005853308069770166,
                -0.000997879690695175,
                -0.9857663352426651, 0.1680162948139519), (
                15710.63491168252, 46201.58850980029, 0.013653191967123652, -0.005853300503703473,
                -0.0009979241086234723,
                -0.9857676101785426, 0.1680088144817751), (
                15710.62416076589, 46201.58473562378, 0.013788459971566054, -0.00585329089703848,
                -0.0009979805121044297,
                -0.985769229051365, 0.16799931570113483), (
                15710.612804566215, 46201.58074923456, 0.013931332916732672, -0.005853278918717133,
                -0.0009980508512436796,
                -0.9857712477633953, 0.16798747007856527), (
                15710.600834620976, 46201.57654776062, 0.014081914942931678, -0.005853264193818294,
                -0.0009981373371080427,
                -0.9857737296716591, 0.16797290528344214), (
                15710.588244844186, 46201.572129186774, 0.0142402799754633, -0.0058532462980730145,
                -0.000998242475267614,
                -0.9857767465370076, 0.16795519940343343), (
                15710.57502870601, 46201.56749136832, 0.014406507201539928, -0.005853224790128737,
                -0.0009983688779292485,
                -0.9857803731167193, 0.16793391258766402), (
                15710.561183021015, 46201.56263336259, 0.014580633937101649, -0.005853199269317403,
                -0.0009985189260452827,
                -0.9857846774543024, 0.1679086439543388), (
                15710.54670504023, 46201.55755440929, 0.014762692119442018, -0.005853169379339083,
                -0.000998694748841386,
                -0.9857897202803373, 0.16787903504199003), (
                15710.531592343094, 46201.552253893664, 0.014952709425438014, -0.005853134791902597,
                -0.0009988983211614165,
                -0.985795557793147, 0.16784475341978944), (
                15710.515842325069, 46201.54673116813, 0.015150715979284484, -0.005853095194108346,
                -0.0009991315390125623,
                -0.9858022438121086, 0.16780547996960204), (
                15710.499450284977, 46201.54098488363, 0.015356768095275414, -0.005853050281866827,
                -0.000999396259810286,
                -0.9858098309165192, 0.1677609021132689), (
                15710.482412947666, 46201.535014226385, 0.015570904159137419, -0.005852999781246955,
                -0.0009996941780071903,
                -0.9858183668664345, 0.16771073476050066), (
                15710.464728706731, 46201.52881900298, 0.01579314161840322, -0.005852943458778367,
                -0.0010000267652571276,
                -0.9858278928788972, 0.1676547303874568), (
                15710.446399328403, 46201.52240023654, 0.016023455526163854, -0.005852881108366385,
                -0.0010003953483156516,
                -0.9858384458528097, 0.16759266592066377), (
                15710.427427020195, 46201.51575913968, 0.01626181518361334, -0.005852812528849752,
                -0.0010008012426483718,
                -0.985850062184895, 0.16752432024160935), (
                15710.407811543353, 46201.50889610452, 0.016508220793385278, -0.005852737557991262,
                -0.0010012455522985977,
                -0.9858627720318761, 0.16744950788833687), (
                15710.387552359156, 46201.501811452865, 0.016762676636987432, -0.00585265612385506,
                -0.001001728864700027,
                -0.9858765905876196, 0.1673681304397843), (
                15710.366650329821, 46201.494506027455, 0.017025169733058627, -0.00585256824721116,
                -0.001002251233471372,
                -0.9858915176206033, 0.1672801794030612), (
                15710.345106438968, 46201.486980740236, 0.017295685873447108, -0.005852474023107027,
                -0.0010028122842453257,
                -0.9859075405351544, 0.16718571838304302), (
                15710.322922082023, 46201.479236669926, 0.017574205960759266, -0.0058523736118096525,
                -0.0010034112647693077, -0.985924635840483, 0.16708487463487656), (
                15710.300099505823, 46201.471275211006, 0.017860700363117644, -0.005852267242471779,
                -0.001004047018719111,
                -0.9859427684462589, 0.16697784345904576), (
                15710.27664026448, 46201.4630975306, 0.01815514836980121, -0.005852155168143574, -0.0010047182502316275,
                -0.9859618992505982, 0.1668648436528172), (
                15710.252544400462, 46201.45470428205, 0.018457548373125052, -0.005852037667035419,
                -0.0010054235134309274,
                -0.9859819848704013, 0.16674611926436475), (
                15710.227814345613, 46201.4460969593, 0.018767869017231476, -0.005851915098175433,
                -0.001006160874026711,
                -0.9860029680467024, 0.16662199654629284), (
                15710.202462932843, 46201.43728067568, 0.01908594819448314, -0.005851787783062937,
                -0.0010069285044417614,
                -0.9860247947193443, 0.16649278324721434), (
                15710.176505346062, 46201.42826135355, 0.019411594810020753, -0.00585165614486933,
                -0.0010077238893578414,
                -0.9860473914341621, 0.16635890255351307), (
                15710.149952394031, 46201.419043374575, 0.01974467262543558, -0.005851520629932762,
                -0.001008544832426952,
                -0.9860706935936179, 0.16622072608263952), (
                15710.122814060142, 46201.409630823655, 0.020085055795482726, -0.005851381628599605,
                -0.0010093891611610954,
                -0.9860946376690573, 0.1660786200174132), (
                15710.095100130962, 46201.400027694246, 0.02043262166448427, -0.00585123964157645,
                -0.0010102540116623607,
                -0.9861191407277066, 0.16593306684304576), (
                15710.066826871082, 46201.39024019821, 0.02078716608706803, -0.00585109513279611,
                -0.0010111367176419102,
                -0.9861441256935759, 0.16578451570740238), (
                15710.038014303796, 46201.38027581208, 0.021148438023750594, -0.005850948597917863,
                -0.0010120343910986899,
                -0.9861695094853274, 0.16563345298690246), (
                15710.00868132316, 46201.370141584506, 0.021516199594494204, -0.005850800312089615,
                -0.0010129454700753891,
                -0.9861952467617293, 0.1654801418350692), (
                15709.978844860914, 46201.35984385722, 0.0218902388660908, -0.005850650761514582, -0.001013867073021402,
                -0.9862212551204202, 0.16532506739127115), (
                15709.948523950006, 46201.349389637544, 0.02227031882122478, -0.005850500624075901,
                -0.0010147950981947065,
                -0.98624741809498, 0.16516892000113795), (
                15709.917737543188, 46201.33878584987, 0.02265620286766781, -0.005850350426376525, -0.00101572633428828,
                -0.986273644750155, 0.16501224006463122), (
                15709.886503845564, 46201.32803909936, 0.023047664989924083, -0.005850200861293938,
                -0.0010166564951589422,
                -0.9862998142954011, 0.1648557487026479), (
                15709.854841403685, 46201.3171560345, 0.023444475308011734, -0.0058500526404544305,
                -0.001017581125179244,
                -0.9863258016724754, 0.16470019540943537), (
                15709.822768448712, 46201.30614312531, 0.0238464073396219, -0.005849906319409422,
                -0.0010184966928387263,
                -0.986351508264245, 0.1645461740831116), (
                15709.790302286328, 46201.29500645854, 0.02425324671497632, -0.005849762492857695,
                -0.0010193993784892975,
                -0.9863768277688892, 0.16439432698322365), (
                15709.75745860034, 46201.283751488954, 0.02466480025041216, -0.005849621847547674,
                -0.0010202847378938252,
                -0.9864016368038057, 0.16424540131786794), (
                15709.724255493154, 46201.27238442626, 0.02508084349150388, -0.005849484853080932,
                -0.001021149650054808,
                -0.9864258494733039, 0.16409992160636924), (
                15709.69071180265, 46201.26091168131, 0.02550114091608546, -0.005849351614084706,
                -0.0010219932758433218,
                -0.9864494439682097, 0.16395802850195743), (
                15709.656845289173, 46201.249339268914, 0.025925469568525913, -0.005849222046130278,
                -0.0010228159730323288,
                -0.9864724319533482, 0.1638196613504839), (
                15709.62267207449, 46201.23767262498, 0.026353627225133628, -0.00584909608408877, -0.001023617984732106,
                -0.9864948218151026, 0.16368477880734422), (
                15709.588209944473, 46201.225917728036, 0.026785391763480215, -0.005848973823869818,
                -0.0010243985317287018,
                -0.9865165933713343, 0.16355351147521496), (
                15709.553476573272, 46201.214080478894, 0.027220543344647595, -0.0058488554935467165,
                -0.0010251559842960464, -0.9865377027788792, 0.16342613297877198), (
                15709.51848833101, 46201.20216628386, 0.027658879746959693, -0.00584874151242207,
                -0.0010258874728814966,
                -0.9865580717878426, 0.16330312540753125), (
                15709.483260129235, 46201.19017997434, 0.028100220201892463, -0.005848632810072398,
                -0.0010265868205520741,
                -0.9865775303582047, 0.16318552695033522), (
                15709.447804827743, 46201.17812555667, 0.02854441286842066, -0.00584853079883487,
                -0.0010272446860836938,
                -0.9865958209504697, 0.1630749077538248), (
                15709.412137968686, 46201.16600780366, 0.028991271728748685, -0.0058484367003226465,
                -0.0010278528933740094,
                -0.9866127190028245, 0.16297264190177882), (
                15709.376274876344, 46201.15383131775, 0.029440608577702143, -0.005848350799582618,
                -0.001028409288672536,
                -0.9866281675239466, 0.16287909078699855), (
                15709.340229943115, 46201.14160037857, 0.029892241870766598, -0.005848272488853418,
                -0.0010289175223356438,
                -0.9866422704436969, 0.1627936399597207), (
                15709.304017024404, 46201.12931913396, 0.030345994720643116, -0.005848200830599334,
                -0.0010293834383054473,
                -0.9866551920597312, 0.1627153062817288), (
                15709.267650519942, 46201.11699198363, 0.03080168290416472, -0.0058481348464188305,
                -0.0010298132036910361,
                -0.986667105108852, 0.16264305241756016), (
                15709.23114619984, 46201.104623859115, 0.03125910557519583, -0.0058480737063657555,
                -0.0010302120690604923,
                -0.9866781564760589, 0.16257599524537317), (
                15709.19451939729, 46201.09221959103, 0.031718068898415414, -0.005848016887300357,
                -0.0010305833221727393,
                -0.9866884383384579, 0.16251358172693428), (
                15709.157784000221, 46201.079783542475, 0.03217839870231018, -0.005847964157488456,
                -0.0010309283718382802,
                -0.986697990637489, 0.16245557476998596), (
                15709.12095270903, 46201.06731967529, 0.03263993684288441, -0.005847915490725912,
                -0.0010312472963652144,
                -0.9867068163737968, 0.16240196099466725), (
                15709.08403758588, 46201.05483172365, 0.03310253378449994, -0.0058478709634308635,
                -0.0010315395094283254,
                -0.9867149000971689, 0.1623528387730549), (
                15709.047052782611, 46201.04232411102, 0.03356601413686523, -0.005847830704554872,
                -0.001031804085176826,
                -0.9867222169245735, 0.16230836356711817), (
                15709.010010769558, 46201.0298006723, 0.03403022364166332, -0.0058477948412436484,
                -0.0010320401138913884,
                -0.9867287423800334, 0.16226868813734768), (
                15708.972923220514, 46201.01726495738, 0.03449501777014627, -0.005847763446525536,
                -0.0010322470462741672,
                -0.9867344619021762, 0.1622339046664779), (
                15708.935800962778, 46201.00472022029, 0.03496026240596814, -0.005847736553303204,
                -0.0010324246035628495,
                -0.9867393683424791, 0.1622040598743639), (
                15708.898649244618, 46200.99216782404, 0.03542589320080259, -0.005847714161257664,
                -0.0010325727335430183,
                -0.986743460738784, 0.16217916241578595), (
                15708.861459544578, 46200.97960448022, 0.03589201806557396, -0.0058476962064962475,
                -0.001032691811087768,
                -0.986746749848585, 0.1621591491712811), (
                15708.82421785129, 46200.96702505342, 0.03635881352724426, -0.0058476825940395214,
                -0.0010327824250683068,
                -0.9867492522566379, 0.16214392106923953), (
                15708.786908437189, 46200.9544238433, 0.036826476450082093, -0.005847673026236033,
                -0.0010328465066630466,
                -0.9867510215414647, 0.16213315341147272), (
                15708.749515725362, 46200.94179522478, 0.03729520320973152, -0.005847667475995605,
                -0.0010328842166541854,
                -0.986752062300135, 0.16212681913155427), (
                15708.71202654295, 46200.929134360806, 0.037765161980359174, -0.005847666253870596,
                -0.0010328935019699233,
                -0.9867523179189207, 0.1621252633368222), (
                15708.674425959922, 46200.916435794185, 0.03824254681089076, -0.006137304873625219,
                -0.001080461122557214,
                -0.986749976862217, 0.16212849612287547), (
                15708.636699033008, 46200.90369403496, 0.038760759264677126, -0.006671276647260636,
                -0.001168148975815716,
                -0.9867450509030143, 0.16213677563795909), (
                15708.598833268923, 46200.89090440946, 0.03932244916358072, -0.007162799395888449,
                -0.001248847140866359,
                -0.9867393079024972, 0.16215015549093323), (
                15708.560816078574, 46200.87806222772, 0.03992467874660703, -0.007611824025301979,
                -0.0013225534435379427,
                -0.9867328078279317, 0.16216866819272624), (
                15708.522633427667, 46200.86516227974, 0.040564525971473066, -0.008018239311910936,
                -0.0013892533169395822,
                -0.9867255688261513, 0.16219256961484493), (
                15708.484271693938, 46200.852199487395, 0.04123903862734379, -0.008381841993900511,
                -0.0014489174887739932,
                -0.9867176721822738, 0.16222170251262596), (
                15708.445718094075, 46200.83916906791, 0.041945210628377035, -0.008702335921026096,
                -0.0015015002084884821,
                -0.9867092197633093, 0.16225575638701692), (
                15708.406960375052, 46200.82606644295, 0.04267996989042296, -0.008979337325062673,
                -0.0015469399079407354,
                -0.9867003322829868, 0.1622942782440811), (
                15708.367988093678, 46200.812887681626, 0.04344013695488214, -0.009212369275710536,
                -0.0015851581089446074,
                -0.9866911419297937, 0.16233671785328602), (
                15708.328792361004, 46200.79962942348, 0.04422241145176318, -0.009400871223817966,
                -0.0016160610937228134,
                -0.9866817939222844, 0.16238241748747773), (
                15708.289361930587, 46200.78628756772, 0.045023435729704714, -0.00954421780095204,
                -0.0016395432330720482,
                -0.986672453231181, 0.16243056928828908), (
                15708.249685353474, 46200.772858017335, 0.04583974011247992, -0.009641698732038934,
                -0.0016554839166532838,
                -0.9866633075370965, 0.16248019749655393), (
                15708.209751938697, 46200.75933700255, 0.04666771289958599, -0.009692514978799725,
                -0.0016637459588124243,
                -0.98665446769026, 0.1625307616718141), (
                15708.169550672816, 46200.74572067758, 0.04750360245322622, -0.009695778697833075,
                -0.0016641772555491792,
                -0.9866460629372938, 0.16258157607749577), (
                15708.129070766665, 46200.73200537467, 0.048343483957105166, -0.009650509782668794,
                -0.0016566119177620854,
                -0.9866383508390567, 0.16263114078021745), (
                15708.088302476717, 46200.718187931, 0.049183230283275474, -0.009555637939881892, -0.001640870171007017,
                -0.9866316310480509, 0.16267766270790368), (
                15708.047236110518, 46200.70426537255, 0.050018519031633776, -0.009410002028477325,
                -0.0016167585903847754,
                -0.9866262002429342, 0.16271932567360836), (
                15708.005861416881, 46200.69023470038, 0.05084483070830853, -0.009212343333422046,
                -0.001584069241860109,
                -0.9866223046817321, 0.16275457400470097), (
                15707.964168733357, 46200.676093253714, 0.051657408978137025, -0.008961305367829943,
                -0.0015425800212062447,
                -0.9866201211771114, 0.1627822224367414), (
                15707.922149199228, 46200.66183875286, 0.05245123949048934, -0.008655434790848729,
                -0.0014920552721792311,
                -0.9866197623774751, 0.16280141800936748), (
                15707.879794331107, 46200.647469134776, 0.05322103975151879, -0.008293178689120606,
                -0.0014322461574347038,
                -0.9866213069392021, 0.16281145092331636), (
                15707.837095998917, 46200.632982546165, 0.05396124015480832, -0.00787288357286191,
                -0.0013628916986667054,
                -0.9866248355001056, 0.1628115297049186), (
                15707.794046719495, 46200.61837745403, 0.054665961816099604, -0.007392797418061825,
                -0.0012837195244127459,
                -0.9866304159488789, 0.16280086282038017), (
                15707.750639524173, 46200.603652591184, 0.05532900308263502, -0.00685106763403642,
                -0.0011944450105067605,
                -0.9866380633093408, 0.1627788936028988), (
                15707.706868175725, 46200.58880700903, 0.05594381805844653, -0.006245744131274039,
                -0.0010947721009193232,
                -0.9866477483709579, 0.162745238912887), (
                15707.662727437486, 46200.5738401659, 0.05650349513154844, -0.005574786607248134,
                -0.0009843960364490638,
                -0.9866594359405236, 0.1626994474122606), (
                15707.618213017664, 46200.55875192511, 0.05700074265601629, -0.00483606927033346,
                -0.0008630059770861512,
                -0.9866731079782186, 0.16264084864294862), (
                15707.573320621297, 46200.54354226184, 0.05742788347171168, -0.004027369187775462,
                -0.0007302851845978841,
                -0.9866887741552476, 0.16256847768552668), (
                15707.528046892847, 46200.52821161723, 0.05777682729755144, -0.003146385416641293,
                -0.0005859165346862439,
                -0.9867064739334714, 0.16248104892078932), (
                15707.482389225075, 46200.51276081288, 0.058039062099885325, -0.002190730681967768,
                -0.00042956749397626316,
                -0.9867260036222182, 0.16237860064236775), (
                15707.436345734091, 46200.4971909722, 0.058205629608577364, -0.0011579600582105358,
                -0.00026092677283574833,
                -0.9867474792334793, 0.16225906221871542), (
                15707.38991518502, 46200.48150387586, 0.05826711850515164, -4.558142306155764e-05, -7.9715209021372e-05,
                -0.9867712874073854, 0.16211853045284552), (
                15707.34309691699, 46200.465701852336, 0.058213654900168985, 0.0011489608575485982,
                0.00011434676418420748,
                -0.9867975494442132, 0.1619545097385717), (
                15707.29589154527, 46200.44978797676, 0.05803488506233481, 0.0024282479999845922, 0.0003215198120365454,
                -0.9868263267418551, 0.1617646472064857), (
                15707.248300346544, 46200.43376582291, 0.05771996059445275, 0.0037948916082485946, 0.000542052811108504,
                -0.9868575361787454, 0.16154723229956008), (
                15707.200325820562, 46200.41763957997, 0.0572575244875011, 0.005251502147308794, 0.0007761806351222805,
                -0.986890940332974, 0.16130124350889805), (
                15707.151971900357, 46200.40141405807, 0.05664771888688622, 0.006370091605636511, 0.0009538673284907535,
                -0.98692903842, 0.16102665988410086), (
                15707.103243392, 46200.38509445374, 0.05594376372771421, 0.007151034827726289, 0.0010753596124379718,
                -0.9869729771825999, 0.160723516057581), (
                15707.054146281132, 46200.36868642455, 0.05515194736422742, 0.007939535920736117, 0.0011970022132701203,
                -0.9870208252259656, 0.16039146338043958), (
                15707.004688084435, 46200.35219619125, 0.0542703241915598, 0.008735476111082288, 0.0013186978741396012,
                -0.9870725346943257, 0.16003050879488204), (
                15706.954876273718, 46200.33563001171, 0.053296969312109, 0.009538735305041004, 0.0014403452916985048,
                -0.9871280757489875, 0.15964053370720757), (
                15706.904719609, 46200.31899464036, 0.052230008597337674, 0.01034917052369408, 0.0015618327309163352,
                -0.9871874536145185, 0.1592211882070815), (
                15706.854228722894, 46200.30229754876, 0.0510676456122176, 0.011166606293065791, 0.0016830311490404525,
                -0.9872507382844375, 0.15877170423875842), (
                15706.803415316039, 46200.28554670721, 0.049808158963230265, 0.011990847865929168,
                0.0018037920618023315,
                -0.9873180801931617, 0.15829079071551558), (
                15706.752291116118, 46200.26875027779, 0.04844988063315889, 0.012821699065280233, 0.0019239592161607703,
                -0.9873896394333386, 0.15777706536032315), (
                15706.700868163958, 46200.251916679525, 0.0469911999222075, 0.013658958252634029, 0.0020433823911344823,
                -0.9874654953744524, 0.15722961836989802), (
                15706.649158680768, 46200.23505448468, 0.04543056198404784, 0.014502420228043328, 0.0021619159826246023,
                -0.9875456696351426, 0.1566478736264596), (
                15706.597175136512, 46200.218172426576, 0.04376647454592575, 0.015351875064860583, 0.002279406990724004,
                -0.9876302018767971, 0.15603111412971638), (
                15706.544931500637, 46200.20127981709, 0.04199755262300977, 0.01620708791884345, 0.0023956939599974894,
                -0.9877191349742032, 0.15537857431915486), (
                15706.492441454686, 46200.18438594289, 0.040122463870154446, 0.01706782821562414, 0.0025106197976581565,
                -0.9878124704724828, 0.1546897191389392), (
                15706.439718711752, 46200.16750014395, 0.03813993905693491, 0.0179338647922962, 0.0026240245085422703,
                -0.9879102076776217, 0.15396399759472482), (
                15706.38677717479, 46200.1506319027, 0.03604878317288418, 0.018804965104663698, 0.0027357195634336285,
                -0.9880124686235946, 0.153200035803499), (
                15706.333630871226, 46200.13379095406, 0.03384787573390256, 0.019680899002904182, 0.0028454676317442697,
                -0.9881195762864522, 0.15239510650895713), (
                15706.280293693299, 46200.11698732615, 0.03153615168642676, 0.020561443232871932, 0.0029530050821742794,
                -0.9882319201116327, 0.1515459629473561), (
                15706.226780267258, 46200.100231583616, 0.029112629093195456, 0.021446364387406668,
                0.003058082760219406,
                -0.9883497494282726, 0.1506501722185045), (
                15706.17310508827, 46200.08353441931, 0.02657637081066007, 0.022335431358088596, 0.0031604820824798234,
                -0.9884731305759722, 0.1497064126495297), (
                15706.119282576685, 46200.06690655088, 0.023926486377709465, 0.02322841431330701, 0.0032600083146042125,
                -0.9886019999530843, 0.1487141513207132), (
                15706.065328267165, 46200.05035899678, 0.021162193322124656, 0.02412506490097526, 0.003356483918766408,
                -0.9887361977877425, 0.1476734452888032), (
                15706.011257057604, 46200.03390245872, 0.01828273302830656, 0.02502514478462656, 0.0034497523943120716,
                -0.9888754834154642, 0.1465848547318521), (
                15705.957083866284, 46200.01754746139, 0.015287401392087764, 0.025928414886559167,
                0.0035396733953812587,
                -0.9890195599675902, 0.14544929705996723), (
                15705.902823654682, 46200.001304333484, 0.01217554916616722, 0.026834637696813754, 0.003626103816256532,
                -0.9891681539356577, 0.14426751827877826), (
                15705.848491339912, 46199.9851832349, 0.008946571409931645, 0.02774358384410184, 0.0037088696283058193,
                -0.9893211155763142, 0.1430393935823366), (
                15705.794102161666, 46199.96919436951, 0.00559992202653712, 0.028655027496626666, 0.003787764216357181,
                -0.989478403642875, 0.14176399742444062), (
                15705.73967207672, 46199.95334812411, 0.0021351416176488627, 0.0295687334467553, 0.0038625890679793388,
                -0.9896399262022441, 0.14044068810164528), (
                15705.68521654941, 46199.9376546096, 0.0, 4.8288416471413626e-05, -0.00034365766672906647,
                -0.9902717890046645, 0.13914619459093414), (
                15705.630749811351, 46199.92212332449, 0.0, 5.012737128770403e-05, -0.0003604765857732985,
                -0.9904692886160151, 0.13773327794096288), (
                15705.576286610349, 46199.90676360593, 0.0, 5.197387355661888e-05, -0.0003778305773764571,
                -0.9906709219247269, 0.13627537927146902), (
                15705.521841695727, 46199.89158453013, 0.0, 5.382277292770892e-05, -0.00039571572326256875,
                -0.9908764461704078, 0.1347728048861428), (
                15705.467429687946, 46199.87659498888, 0.0, 5.566989955525419e-05, -0.0004141389920504184,
                -0.9910857379830283, 0.13322494269615445), (
                15705.413063252397, 46199.86180324604, 0.0, 5.751082099872335e-05, -0.0004331070325533968,
                -0.9912986610646446, 0.1316312033001547), (
                15705.358747159959, 46199.84721531408, 0.0, 5.93402444864262e-05, -0.00045261969647173464,
                -0.9915149948057826, 0.12999156391641256), (
                15705.30447999524, 46199.83283545216, 0.0, 6.11523609783839e-05, -0.00047267267545360374,
                -0.9917344676097738, 0.12830634666955948), (
                15705.250256143456, 46199.81866675876, 0.0, 6.294127648238192e-05, -0.0004932617105468927,
                -0.9919568051130814, 0.126575864686475), (
                15705.196066567376, 46199.80471144429, 0.0, 6.470109614321214e-05, -0.000514383594106453,
                -0.9921817408892994, 0.12480033761639137), (
                15705.141899714297, 46199.79097112858, 0.0, 6.642591531233625e-05, -0.0005360362648848144,
                -0.9924090167642622, 0.12297988330499852), (
                15705.087743541246, 46199.7774474072, 0.0, 6.81098892250091e-05, -0.0005582200151832723,
                -0.9926383943878145, 0.12111441589934396), (
                15705.033586689211, 46199.76414218374, 0.0, 6.974721775420663e-05, -0.0005809379117387261,
                -0.9928696576244462, 0.11920360990835391), (
                15704.979412795932, 46199.751056313726, 0.0, 7.13319504279204e-05, -0.0006041937014137237,
                -0.993102589408427, 0.11724707575032035), (
                15704.925204690666, 46199.7381906773, 0.0, 7.285784981466472e-05, -0.0006279898975724952,
                -0.9933369523304699, 0.11524452028290069), (
                15704.870944827277, 46199.72554621072, 0.0, 7.431678642541288e-05, -0.0006522997149218045,
                -0.9935722203285487, 0.11319810940777676), (
                15704.816615434996, 46199.713123849455, 0.0, 7.570384459593174e-05, -0.0006771506534386582,
                -0.9938083913267522, 0.11110543220047085), (
                15704.76219925843, 46199.70092552136, 0.0, 7.701517145955248e-05, -0.0007026043112040312,
                -0.9940457528667671, 0.10896119319917257), (
                15704.707678818086, 46199.68895365643, 0.0, 7.824361756821815e-05, -0.0007286768086362018,
                -0.9942841293397973, 0.10676391268142085), (
                15704.653036904469, 46199.677211133574, 0.0, 7.93813020543052e-05, -0.0007553783351645,
                -0.9945232727056936,
                0.10451259803935796), (
                15704.598256792719, 46199.66570125335, 0.0, 8.041956994807795e-05, -0.0007827086269182309,
                -0.9947628282163893, 0.10220712547972614), (
                15704.543322127043, 46199.65442761179, 0.0, 8.134924798703252e-05, -0.0008106576138559564,
                -0.9950023496464272, 0.09984818683692737), (
                15704.48821698344, 46199.643394041675, 0.0, 8.21609701463755e-05, -0.000839208838895063,
                -0.9952413373175273, 0.09743700258382161), (
                15704.432926225929, 46199.63260464224, 0.0, 8.284545370675229e-05, -0.0008683446691953965,
                -0.9954792869528079, 0.09497488279590262), (
                15704.377435593358, 46199.62206382075, 0.0, 8.339367988228553e-05, -0.00089805492265901,
                -0.9957157591657664, 0.0924624977587764), (
                15704.321731996199, 46199.61177643653, 0.0, 8.379675085030756e-05, -0.0009283402618838856,
                -0.9959503979535536, 0.08989958831174472), (
                15704.265805185265, 46199.60174817909, 0.0, 8.404559348701485e-05, -0.0009592093915327219,
                -0.9961828982858829, 0.08728519929758782), (
                15704.209645891193, 46199.591985260624, 0.0, 8.413073657755166e-05, -0.0009906761101992326,
                -0.9964129756867756, 0.08461792579524285), (
                15704.153244650319, 46199.582494232774, 0.0, 8.404218404365361e-05, -0.001022754173831418,
                -0.9966403240125353, 0.08189634584644023), (
                15704.096592513659, 46199.57328198663, 0.0, 8.3769794954958e-05, -0.001055421455449438,
                -0.9968643729367095,
                0.07912206416464262), (
                15704.039682047362, 46199.56435557597, 0.0, 8.330363707002293e-05, -0.0010886587350163331,
                -0.9970845816936426, 0.07629642738344139), (
                15703.982504890422, 46199.55572219165, 0.0, 8.263313179517377e-05, -0.0011224843278377897,
                -0.9973006532702108, 0.0734175741053191), (
                15703.925053501998, 46199.54738960698, 0.0, 8.174682231724616e-05, -0.0011569236698795026,
                -0.9975123058454569, 0.070483008817434), (
                15703.86732085273, 46199.53936605742, 0.0, 8.063372497688094e-05, -0.001191963440186745,
                -0.9977189977648067, 0.06749351243304294), (
                15703.809301505611, 46199.531660143395, 0.0, 7.928070303239027e-05, -0.0012276439645107014,
                -0.9979204851776301, 0.06444526256994998), (
                15703.75099117648, 46199.52428166738, 0.0, 7.767190054589177e-05, -0.0012640353939281708,
                -0.9981166273001718, 0.061331839109297355), (
                15703.69238709985, 46199.51724111712, 0.0, 7.579298733706942e-05, -0.0013011397484522238,
                -0.9983068548553347, 0.05815259959475314), (
                15703.633485895567, 46199.510549078484, 0.0, 7.362996428796211e-05, -0.0013389461837558087,
                -0.9984905188707972, 0.05490797325408682), (
                15703.574285752991, 46199.504216369, 0.0, 7.116939934331969e-05, -0.001377433717710086,
                -0.9986669197755711,
                0.05159923407612559), (
                15703.514785949907, 46199.49825390292, 0.0, 6.839794914330837e-05, -0.0014165824112211784,
                -0.9988353681192369, 0.04822754410190851), (
                15703.454986862356, 46199.49267272839, 0.0, 6.53017171432343e-05, -0.0014563809804664747,
                -0.9989952129101745, 0.04479329495226614), (
                15703.394889677282, 46199.48748406119, 0.0, 6.186623898269777e-05, -0.0014968235678037005,
                -0.9991458175569343, 0.04129637938440498), (
                15703.334496340876, 46199.482699290245, 0.0, 5.8076760008642037e-05, -0.0015379047498246465,
                -0.999286535047692, 0.03773661813740384), (
                15703.273809517734, 46199.47832996233, 0.0, 5.3918226606028654e-05, -0.0015796193623485858,
                -0.9994167060760037, 0.03411377304969064), (
                15703.212832589019, 46199.474387773706, 0.0, 4.937528026825459e-05, -0.001621962353354215,
                -0.9995356574568509, 0.030427557780848342)]
obs_pose = [(15721.95023045896, 46138.0587925926, 1.25, 0.0, 0.0, 0.8204657537283921, 0.5716956768761694), (
    15721.660489037748, 46138.84767042013, 1.2499999999999998, 0.0, 0.0, 0.8193894838456642, 0.5732371880497076), (
                15721.373665329627, 46139.63752696923, 1.2499999999999998, 0.0, 0.0, 0.8185534849946479,
                0.5744303197108565),
            (15721.088673776843, 46140.42788521692, 1.25, 0.0, 0.0, 0.8180956003334702, 0.5750822451745655),
            (15720.805011795583, 46141.21878709866, 1.25, 0.0, 0.0, 0.8174820844719359, 0.5759540273037586),
            (15720.522635580306, 46142.009962370634, 1.25, 0.0, 0.0, 0.817333571971478, 0.576164761269157),
            (15720.240042794534, 46142.800934889536, 1.25, 0.0, 0.0, 0.8174960118491781, 0.5759342589312503),
            (15719.957299214497, 46143.59191911845, 1.25, 0.0, 0.0, 0.8174960396488646, 0.5759342194716528), (
                15719.662042181526, 46144.364781223216, 1.2499999999999998, 0.0, 0.0, 0.8475812402166154,
                0.530665658614597),
            (15719.295994105532, 46145.12120156126, 1.25, 0.0, 0.0, 0.8468786029163673, 0.531786265263049),
            (15718.931999424505, 46145.878481997934, 1.25, 0.0, 0.0, 0.8461735661468444, 0.5329073990425842),
            (15718.570014269444, 46146.636831286174, 1.25, 0.0, 0.0, 0.8454501438361697, 0.5340543551806314),
            (15718.210007826481, 46147.39603681399, 1.25, 0.0, 0.0, 0.8448044209641346, 0.5350752193098213),
            (15717.84964492943, 46148.1544393205, 1.2499999999999998, 0.0, 0.0, 0.8455990497485621, 0.5338185525666269),
            (15717.491942829889, 46148.916237418154, 1.25, 0.0, 0.0, 0.8416858413445448, 0.5399675402097108),
            (15717.151379460483, 46149.6871136984, 1.25, 0.0, 0.0, 0.8344255588674404, 0.5511206643819117),
            (15716.826133343808, 46150.46284259214, 1.25, 0.0, 0.0, 0.8318041158810947, 0.5550692864888764),
            (15716.5019567829, 46151.23721010172, 1.25, 0.0, 0.0, 0.8332243167031652, 0.5529351119747627),
            (15716.176772703326, 46152.01244082348, 1.25, 0.0, 0.0, 0.8315274323348203, 0.5554836894767126),
            (15715.861094497193, 46152.7925536962, 1.25, 0.0, 0.0, 0.8273313925524235, 0.5617141327198985),
            (15715.554985976718, 46153.576512792126, 1.25, 0.0, 0.0, 0.8233902804707796, 0.5674755025780858),
            (15715.265735387586, 46154.368640276036, 1.25, 0.0, 0.0, 0.8144938979205807, 0.5801721212279497),
            (15715.0050898554, 46155.17056998439, 1.25, 0.0, 0.0, 0.8052506750831253, 0.5929345244444542),
            (15714.756740661589, 46155.972864156895, 1.25, 0.0, 0.0, 0.8062592299037619, 0.5915623840263957),
            (15714.502027732073, 46156.77285016304, 1.25, 0.0, 0.0, 0.8074308915242084, 0.5899621643905836),
            (15714.24732853959, 46157.573552029884, 1.25, 0.0, 0.0, 0.8067921006113938, 0.5908354308866849), (
                15713.995106412549, 46158.375131670466, 1.2499999999999998, 0.0, 0.0, 0.8058706641727661,
                0.5920916083054587),
            (15713.744982639144, 46159.17731718247, 1.25, 0.0, 0.0, 0.805134105619959, 0.5930928021545605),
            (15713.459828199275, 46159.954236715035, 1.25, 0.0, 0.0, 0.8354591248207206, 0.549552591435793),
            (15713.127201724541, 46160.72557297654, 1.25, 0.0, 0.0, 0.8354591248208322, 0.5495525914356234),
            (15712.794244126446, 46161.49616850565, 1.25, 0.0, 0.0, 0.8368106478871788, 0.5474924105251506),
            (15712.45621142712, 46162.26524029198, 1.25, 0.0, 0.0, 0.8365476366531639, 0.5478941974596976),
            (15712.129367002513, 46163.042680370265, 1.25, 0.0, 0.0, 0.827941434188519, 0.5608145696697424), (
                15711.829120385806, 46163.83004020716, 1.2499999999999998, 0.0, 0.0, 0.8202642315131295,
                0.5719847817033028),
            (15711.540668759802, 46164.61937885217, 1.25, 0.0, 0.0, 0.820033897896589, 0.5723149537628095),
            (15711.250569882868, 46165.40781260467, 1.25, 0.0, 0.0, 0.8196848496236222, 0.5728147582748718), (
                15710.962215089887, 46166.196864996375, 1.2499999999999998, 0.0, 0.0, 0.8195593831220053,
                0.5729942561114187),
            (15710.673314130421, 46166.98554245562, 1.25, 0.0, 0.0, 0.8197746393514649, 0.5726862497704792),
            (15710.384204173015, 46167.77417289151, 1.25, 0.0, 0.0, 0.8198953736849021, 0.5725133851798531),
            (15710.094495063062, 46168.56251023219, 1.25, 0.0, 0.0, 0.8201949060808438, 0.5720841861466158),
            (15709.804073328547, 46169.35063888496, 1.25, 0.0, 0.0, 0.8203635209435818, 0.5718423677072638),
            (15709.513413725395, 46170.13874187568, 1.25, 0.0, 0.0, 0.8203804479852097, 0.5718180834527592),
            (15709.222645113705, 46170.9267850836, 1.25, 0.0, 0.0, 0.8204449614211999, 0.5717255156791288),
            (15708.931740897833, 46171.7147921873, 1.25, 0.0, 0.0, 0.8204755493149006, 0.5716816185399108),
            (15708.640745402143, 46172.50276135766, 1.25, 0.0, 0.0, 0.8205162977303928, 0.5716231321061188),
            (15708.349653200214, 46173.29070032155, 1.25, 0.0, 0.0, 0.820543544930757, 0.5715840190842173),
            (15708.058538654815, 46174.078646254624, 1.25, 0.0, 0.0, 0.8205337957579111, 0.5715980143589677),
            (15707.767348193644, 46174.86652192525, 1.25, 0.0, 0.0, 0.8206273586974816, 0.5714636805232638),
            (15707.475780764, 46175.654235345, 1.2500000000000002, 0.0, 0.0, 0.820776473459359, 0.5712494906917802), (
                15707.183855867728, 46176.441826636146, 1.2499999999999998, 0.0, 0.0, 0.8209004687867097,
                0.5710712918241996),
            (15706.891567783503, 46177.22926746941, 1.25, 0.0, 0.0, 0.8210624940456007, 0.5708383141237262),
            (15706.598826768728, 46178.01656035883, 1.25, 0.0, 0.0, 0.821175188997262, 0.5706761857439917), (
                15706.305987748052, 46178.80388069978, 1.2499999999999998, 0.0, 0.0, 0.8211316811061276,
                0.5707387863846514),
            (15706.013234090582, 46179.59121450155, 1.25, 0.0, 0.0, 0.8211328844721103, 0.5707370550774779),
            (15705.720477110646, 46180.37854707521, 1.25, 0.0, 0.0, 0.8211340878344231, 0.5707353237677952),
            (15705.40951658877, 46181.15588115704, 1.25, 0.0, 0.0, 0.8286413056981812, 0.5597799447022137),
            (15705.096637414312, 46181.93566024627, 1.25, 0.0, 0.0, 0.828092127304868, 0.560592034099396),
            (15704.785138315061, 46182.715921627525, 1.25, 0.0, 0.0, 0.8277246178268041, 0.561134526689876),
            (15704.474900957535, 46183.49684568903, 1.25, 0.0, 0.0, 0.8269783735137178, 0.5622337323041066),
            (15704.167558693634, 46184.279155134354, 1.25, 0.0, 0.0, 0.8256170888355312, 0.564230823885706),
            (15703.863892199492, 46185.06278444185, 1.25, 0.0, 0.0, 0.824539118575383, 0.5658049504369245),
            (15703.562406032535, 46185.84700343312, 1.25, 0.0, 0.0, 0.824105782565874, 0.5664359267750312),
            (15703.263183047748, 46186.632371618005, 1.25, 0.0, 0.0, 0.82294640431212, 0.5681190153742021),
            (15702.964837845999, 46187.417255167275, 1.25, 0.0, 0.0, 0.8238137397084233, 0.5668605845070039),
            (15702.661504983276, 46188.19953850851, 1.25, 0.0, 0.0, 0.8262983395718972, 0.5632326819536714),
            (15702.353630907803, 46188.981068812274, 1.25, 0.0, 0.0, 0.8263850976112566, 0.5631053812973501),
            (15702.049222037318, 46189.764957951294, 1.25, 0.0, 0.0, 0.8239711426084372, 0.5666317641542401),
            (15701.750482204427, 46190.55055421531, 1.25, 0.0, 0.0, 0.8227306245244819, 0.5684314553836338),
            (15701.45347315354, 46191.336230067864, 1.25, 0.0, 0.0, 0.8228592849057464, 0.5682451911317892),
            (15701.156235775205, 46192.12198794874, 1.25, 0.0, 0.0, 0.822626815328375, 0.5685816763690997),
            (15700.859464117848, 46192.9078326411, 1.25, 0.0, 0.0, 0.822581594780451, 0.5686470961224105),
            (15700.56239224443, 46193.693444354096, 1.25, 0.0, 0.0, 0.8228558147986279, 0.5682502160598676), (
                15700.265115072118, 46194.47923332314, 1.2500000000000002, 0.0, 0.0, 0.822502869908691,
                0.5687609594477868),
            (15699.969448315658, 46195.2654303098, 1.25, 0.0, 0.0, 0.8226085600687969, 0.5686080872635744),
            (15699.672585338374, 46196.05172500316, 1.25, 0.0, 0.0, 0.8216217654720316, 0.57003304685134)]


def draw_tracing():
    ls1 = [(x[0], x[1]) for x in ego_pose]
    ls2 = [(x[0], x[1]) for x in obs_pose]

    x_1 = [x[0] for x in ego_pose]
    y_1 = [x[1] for x in ego_pose]
    x_2 = [x[0] for x in obs_pose]
    y_2 = [x[1] for x in obs_pose]

    x_min = min(min(x_1), min(x_2))
    y_min = min(min(y_1), min(y_2))

    x_max = max(max(x_1), max(x_2))
    y_max = max(max(y_1), max(y_2))

    fig, ax = plt.subplots()

    x, y = zip(*ls1)
    ax.plot(x, y, label='Linestring')

    z, w = zip(*ls2)
    ax.plot(z, w, label='Linestring')
    ax.set_xlim(x_min, x_max)
    ax.set_ylim(y_min, y_max)

    plt.show()


def draw_last_position():
    fig, ax = plt.subplots()

    def obstacle_to_polygon(
            pos_x: float, pos_y: float, theta: float, length: float, width: float
    ):
        points = []
        half_l = length / 2.0
        half_w = width / 2.0
        sin_h = math.sin(theta)
        cos_h = math.cos(theta)
        vectors = [
            (half_l * cos_h - half_w * sin_h, half_l * sin_h + half_w * cos_h),
            (-half_l * cos_h - half_w * sin_h, -half_l * sin_h + half_w * cos_h),
            (-half_l * cos_h + half_w * sin_h, -half_l * sin_h - half_w * cos_h),
            (half_l * cos_h + half_w * sin_h, half_l * sin_h - half_w * cos_h),
        ]
        for x, y in vectors:
            points.append((pos_x + x, pos_y + y))
        return points

    def generate_adc_polygon(x, y, theta: float):
        points = []
        half_w = AUTOWARE_VEHICLE_WIDTH / 2.0
        front_l = AUTOWARE_VEHICLE_LENGTH - AUTOWARE_VEHICLE_back_edge_to_center
        back_l = -1 * AUTOWARE_VEHICLE_back_edge_to_center
        sin_h = math.sin(theta)
        cos_h = math.cos(theta)
        vectors = [(front_l * cos_h - half_w * sin_h,
                    front_l * sin_h + half_w * cos_h),
                   (back_l * cos_h - half_w * sin_h,
                    back_l * sin_h + half_w * cos_h),
                   (back_l * cos_h + half_w * sin_h,
                    back_l * sin_h - half_w * cos_h),
                   (front_l * cos_h + half_w * sin_h,
                    front_l * sin_h - half_w * cos_h)]
        for x_, y_ in vectors:
            points.append((x + x_, y + y_))
        return points
        # return Polygon([[xx.x, xx.y] for xx in points])

    # q1=Quaternion(x=ego_pose[-1][3], y=ego_pose[-1][4], z=ego_pose[-1][5], w=ego_pose[-1][6])
    # q2=Quaternion(x=obs_pose[-1][3], y=obs_pose[-1][4], z=obs_pose[-1][5], w=obs_pose[-1][6])
    obs_ply = obstacle_to_polygon(81574.5395497169, 50202.73681181819, -1.3962531495594706, 4.0, 1.8)
    # print(obs_ply)
    obs_oo = shapely.geometry.Polygon(obs_ply)
    adc_ply = generate_adc_polygon(81579.16146743215, 50200.23833221861, -3.0552839324882917)
    # print(adc_ply)

    ego_oo = shapely.geometry.Polygon(adc_ply)

    # print(obs_oo.distance(ego_oo))
    x_min = float('inf')
    x_max = -1
    y_min = float('inf')
    y_max = -1
    for obs in obs_ply:
        x_min = min(obs[0], x_min)
        x_max = max(obs[0], x_max)
        y_min = min(obs[1], y_min)
        y_max = max(obs[1], y_max)

    for ego in adc_ply:
        x_min = min(ego[0], x_min)
        x_max = max(ego[0], x_max)
        y_min = min(ego[1], y_min)
        y_max = max(ego[1], y_max)

    lanes_id = [410, 398, 399, 397]
    for lane_id in lanes_id:
        l, r = map_service.get_lane_boundaries_by_id(lane_id)
        cl = map_service.get_center_line_lst_by_id(lane_id)
        draw_lane(l, ax)
        draw_lane(r, ax)
        draw_road_direction(cl, ax)

    # polygon = Polygon(adc_ply, closed=True, edgecolor='#009E73', facecolor='#009E73', linewidth=1, zorder=2)
    # ax.add_patch(polygon)
    # ax.set_label('Polygon')
    #
    # polygon2 = Polygon(obs_ply, closed=True, edgecolor='#ff718e', facecolor='#ff718e', linewidth=1, zorder=2)
    # ax.add_patch(polygon2)
    # ax.set_label('Polygon2')
    # print(x_max, x_min, y_max, y_min)
    ax.set_xlim(x_min - 15, x_max + 15)
    ax.set_ylim(y_min - 15, y_max + 15)

    # ls1 = [(x[0], x[1]) for x in ego_pose]
    # ls2 = [(x[0], x[1]) for x in obs_pose]
    #
    # x, y = zip(*ls1)
    # ax.plot(x, y, label='Linestring')
    #
    # z, w = zip(*ls2)
    # ax.plot(z, w, label='Linestring')
    plt.axis('off')
    plt.savefig("./road.jpg", bbox_inches='tight', pad_inches=0.15, dpi=600)
    plt.show()


def draw_lane(l, ax):
    xx, yy = l.xy
    ax.plot(xx, yy, label='l', color='grey', zorder=1)


def draw_road_direction(l, ax):
    xx, yy = l.xy
    for i in range(len(xx) - 1):
        ax.arrow(x=xx[i], y=yy[i], dx=xx[i + 1] - xx[i], dy=yy[i + 1] - yy[i], head_width=0.5, head_length=.5,
                 fc='lightblue', ec='#2c9abc', zorder=1)


if __name__ == '__main__':
    map_service = load_map_service("awf_cicd_virtualmap")
    draw_last_position()
